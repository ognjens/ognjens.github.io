function errorAlert(e,t){swal(e,t,"error")}function successAlert(e,t){swal(e,t,"success")}!function(){"use strict";angular.module("dashboard",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ui.router","pascalprecht.translate","LocalStorageModule","ngMask","atomic-notify","ngIdle"])}(),function(){"use strict";function e(e,t,a,n,o,r,i){var s={"Content-Type":"application/json",Accept:"*"};return{ajax:function(l,c,d,u,p){n.get("user_id")&&(s["x-user"]=n.get("user_id")),n.get("auth_token")&&(s["x-auth-token"]="Bearer "+n.get("auth_token"));var m=_.isUndefined(p)||_.isNull(p)?"":p,g=_.isUndefined(s)||_.isNull(s)?[]:s;t({withCredentials:!1,method:l,url:a+c,headers:g,data:m}).success(function(t){e.log("Successful AJAX call."),e.log(t),d(t)}).error(function(t){e.log("Ajax error"),e.log(t),u?u(t):(o.error(r("translate")("SERVER_ERROR")),(_.isNull(t)||t.meta&&401===t.meta.code)&&(n.clearAll(),i.go("login")))})},post:function(e,t,a,n){return this.ajax("POST",e,a,n,t)},put:function(e,t,a,n){return this.ajax("PUT",e,a,n,t)},get:function(e,t,a){return this.ajax("GET",e,t,a)},"delete":function(e,t,a){return this.ajax("DELETE",e,t,a)}}}e.$inject=["$log","$http","apiUrl","localStorageService","atomicNotifyService","$filter","$state"],angular.module("dashboard").service("xHttp",e)}(),function(){"use strict";function e(e,t,a){function n(e,n,o){a.post("/user_session",e,function(e){e.auth_token&&e.user_id?(t.set("auth_token",e.auth_token),t.set("user_id",e.user_id),n()):o()},o)}function o(){a.delete("/user_session",function(){}),t.clearAll(),i={}}function r(e,n){i?e(i):a.get("/user_session",function(a){a.meta&&a.meta.code&&200===a.meta.code?(t.set("permissions",a.data.permissions),i=a.data,e(i)):n()},n)}var i={};return{loginUser:n,logOutUser:o,getUser:r}}e.$inject=["$log","localStorageService","xHttp"],angular.module("dashboard").factory("userSingleton",e)}(),function(){"use strict";function e(e){var t={restrict:"A",link:function(t,a){t.$watch("authentication.user",function(){e(function(){a.metisMenu()})})}};return t}e.$inject=["$timeout"],angular.module("dashboard").directive("sideNavigation",e)}(),function(){"use strict";function e(e,t){var a=[],n=function(){try{a=angular.fromJson(t.get("permissions"))}catch(n){e.log(n),a=[]}};return n(),{isAllowed:function(e){return a||n(),"admin"===a[0]?!0:!(e&&!_.contains(a,e))},resetPermissions:function(){a=null}}}e.$inject=["$log","localStorageService"],angular.module("dashboard").service("permissionStatus",e)}(),function(){"use strict";function e(e){var t={restrict:"A",link:function(t,a,n){var o=n.permissionNeeded;e.isAllowed(o)||a.hide()}};return t}e.$inject=["permissionStatus"],angular.module("dashboard").directive("permissionNeeded",e)}(),function(){"use strict";function e(e){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary "href="" data-ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element","localStorageService",function(t,a,n){_.isNull(n.get("collapse"))?n.set("collapse",!1):n.get("collapse")&&angular.element("body").toggleClass("mini-navbar"),t.minimalize=function(){n.get("collapse")?n.set("collapse",!1):n.set("collapse",!0),angular.element("body").toggleClass("mini-navbar"),!angular.element("body").hasClass("mini-navbar")||angular.element("body").hasClass("body-small")?(angular.element("#side-menu").hide(),e(function(){angular.element("#side-menu").fadeIn(400)},200)):angular.element("#side-menu").removeAttr("style")}}]}}e.$inject=["$timeout"],angular.module("dashboard").directive("minimalizaSidebar",e)}(),function(){"use strict";function e(){var e=function(e,t,a,n){this.id=e,this.href="/"+this.id;var o=this.id,r=this.id;this.contentUrl="app/"+o+"/"+r+"/"+r+".html",this.neededPermission=n,this.icon=a,this.name=t};this.items=[new e("dashboard","DASHBOARD","dashboard","dashboard"),new e("contacts","CONTACTS","list","contacts_view_all")],this.$get=function(){return{items:this.items}}}angular.module("dashboard").provider("menu",e)}();var FR={SCAN_RAMQ_TITLE:"Veuillez s’il vous plaît scanner ",SCAN_RAMQ_END:"carte NAM",YOUR:"votre",CONTINUE:"Continuer",ADD_MANUALLY:"Ou entrez les informations dans la case ci-dessous ",RAMQ_NUMBER:"Numéro d'assurance-maladie NAM",FORGOT_RAMQ:"Si vous avez oublié votre carte NAM ou si vous n’en avez pas,",CLICK_HERE:"Cliquez ici",LOADING:"Nous cherchons vos rendez-vous",HI:"Bonjour",FOUND_APPT:"Nous avons trouvé rendez-vous",FOUND_APPTS:"Nous avons trouvé ",FOUND_APPTS_END:" rendez-vous",NOT_MINE:"Ce n'est pas mon rendez-vous",NOT_MINE_MULTI:"Ce ne sont pas mes rendez-vous",TODAY:"Aujourd’hui",CLOSE:"Fermer",OOPS:"Oups, nous n'avons pas trouvé votre rendez-vous.",RECEPTIONIST:"veuillez s’il vous plaît vous adresser à la réceptionniste.",YES:"Oui",CANCEL:"Annuler",CANT_FIND:"Oups, nous n'avons pas trouvé votre rendez-vous",RUNNING_LATE:"Nous avons trouvé votre rendez-vous, mais vous êtes en retard",EXPIRED:"Votre carte NAM est expirée",VERIFY_INFO:"Dernière étape! S’il vous plaît vérifier vos informations",TAP_EDIT:"Appuyez pour modifier",CELL:"Cellulaire",EMAIL:"Adresse courriel",ADDRESS:"Adresse",ADD_ADDRESS:"Ajouter mon adresse",CITY:"Ville",COUNTRY:"Pays",PROVINCE:"Province / État",POSTAL:"Code Postal",GO:"C’est parti",CONFIRM:"Confirmer et enregistrer",ALL_SET:"Et voilà, vous êtes enregistré!",WAIT_ROOM:"Veuillez vous présenter dans la salle d’attente ",UPDATES:"Recevez des mises à jour en temps réel en attendant votre tour!",DOWNLOAD:"Télécharger Tap médical sur l'App Store ou sur google play.",CANCEL_TEXT:"Êtes-vous sûr de vouloir annuler l'enregistrement?",NO:"Non",CHANGE_ADDRESS:"Changer mon adresse",RAMQ_NUMBER:"Numéro de NAM",RAMQ_EXPIRY:"Expiration",INSTRUCTIONS_TEXT:"Pour les nouvelles cartes NAM, scanner le ",INSTRUCTIONS_TEXT_END:" code barre situé en haut et à droite de votre carte.",SMALLER:"petit",CHECK_IN:"S'enregistrer",CHECK_IN_ALL:"S'enregistrer à tous les rendez-vous",OPTIONAL:"Facultatif",IN_CUT:"Dans ",RESET_FLOW_MESSAGE:" secondes ce formulaire sera effacé et l’écran d’accueil sera affiché",YOUR:"votre"},EN={SCAN_RAMQ_TITLE:" Enter",SCAN_RAMQ_END:" Health card",YOUR:"your",CONTINUE:"Continue",ADD_MANUALLY:"Or tap to add it manually",RAMQ_NUMBER:"PHN health Insurance Number",FORGOT_RAMQ:"Forgot your PHN card, or don’t have one?",CLICK_HERE:"Click here",LOADING:"We’re looking for your appointments",HI:"Hi",FOUND_APPT:"We found your appointment",FOUND_APPTS:"We found ",FOUND_APPTS_END:" of your appointments",NOT_MINE:"This isn’t my appointment",NOT_MINE_MULTI:"These aren’t my appointments",TODAY:"Today",CLOSE:"Close",OOPS:"Oops, sorry about that.",RECEPTIONIST:"Please check in with the receptionist",YES:"Yes",CANCEL:"Cancel",CANT_FIND:"Oops, we couldn’t find your appointment",RUNNING_LATE:"We found your appointment, but it looks like you’re running a little late.",EXPIRED:"Your PHN card is expired",VERIFY_INFO:"Please verify your information",TAP_EDIT:"Tap to edit",CELL:"Cell",EMAIL:"Email",ADDRESS:"Address",ADD_ADDRESS:"Add my address",CITY:"City",COUNTRY:"Country",PROVINCE:"Province / State",POSTAL:"Postal Code",GO:"Go",CONFIRM:"Confirm and Check-in",ALL_SET:"You’re all set!",WAIT_ROOM:"Please go to waiting room ",UPDATES:"Receive live updates “while you wait”!",DOWNLOAD:"Download Tap medical on the app store or google play.",CANCEL_TEXT:"Are you sure you want to cancel check-in?",NO:"No",CHANGE_ADDRESS:"Change my address",RAMQ_NUMBER:"Health card number",RAMQ_EXPIRY:"Expiry",INSTRUCTIONS_TEXT:"For new PHN cards, scan the top right, ",INSTRUCTIONS_TEXT_END:"barcode on the back.",SMALLER:"smaller",CHECK_IN:"Check in",CHECK_IN_ALL:"Check in to all appointments",OPTIONAL:"Optional",IN_CUT:"In ",RESET_FLOW_MESSAGE:" seconds this form will be cleared and the home screen will be displayed",YOUR:"your"};angular.module("dashboard").controller("ScanRamqCtrl",["$log","$scope","$state","$timeout","$rootScope","localStorageService","CoreFactory",function(e,t,a,n,o,r,i){var s=/[A-Za-z]{4}\d{8}/;return t.forgot=!1,t.scanValue=null,t.forgotShow=!1,t.turnOnScanner=function(){window.kp_padlockScan_getHardwareClass(),window.kp_padlockScan_start()},t.submit=function(){var e={ramq:"Please enter PHN",format:"Invalid PHN format"};if("FR"==r.get("language"))var e={ramq:"S'il vous plaît entrer votre NAM",format:"Format NAM non valide"};t.ramqNumber?t.ramqNumber.length<11?errorAlert(e.ramq):s.test(t.ramqNumber)?(t.prepopulate={ramq:t.ramqNumber,year:t.ramqNumber.slice(4,6),month:t.ramqNumber.slice(6,8),day:t.ramqNumber.slice(8,10),noRAMQ:!1},r.set("prepopulate",t.prepopulate),a.go("main"==r.get("scan")?"new-user-info":"new-profile-info")):errorAlert("number format wrong"):errorAlert(e.ramq)},t.scanType=r.get("scan"),t.skipStep=function(){t.prepopulate={ramq:"",year:"",month:"",day:"",noRAMQ:!0},r.set("prepopulate",t.prepopulate),a.go("main"==r.get("scan")?"new-user-info":"new-profile-info")},t.clickOnScan=function(){$("#scanInput").prop("readonly",!1)},n(function(){$("#scanInput").trigger("focus")},200),t.$watch("scanValue",function(e){t.showButton=s.test(e)?!0:!1}),window.kp_padlockScan_scanningDidFinish=function(e,a){t.scanValue=a,t.submitRAMQ()},t.submitRAMQ=function(){t.showLoader=!0,i.getUserByRAMQ(t.scanValue).then(function(e){r.set("user",e),t.showLoader=!1,a.go("appointments",{},{reload:!0})}).catch(function(){t.forgot=!0,t.wrongAppt=!0,t.showLoader=!1})},t.showForgot=function(){t.forgotShow=!0,t.forgot=!0},t}]),angular.module("dashboard").controller("MainCtrl",["$log","$scope","xHttp","$timeout","userSingleton","$state","localStorageService","$rootScope","$window","CoreFactory","Idle","Keepalive",function(e,t,a,n,o,r,i,s,l,c,d){e.log("Main Controller"),window.kp_padlockScan_getHardwareClass(),t.$on("$stateChangeStart",function(){t.userProfile=i.get("user")}),t.clinicData=null,t.clinicData||c.getClinicName(),window.kp_padlockScan_scanningDidFinish=function(){console.log("scanned")},t.goBack=function(){window.history.back()},t.closeCancel=function(){t.closing=!1},t.closeModal=function(){t.closing=!0};var u;t.counter=60,t.onTimeout=function(){t.counter--,u=n(t.onTimeout,1e3)},t.stopTimer=function(){n.cancel(u)},t.onTimeout(),t.started=!1,t.$on("IdleStart",function(){t.showResetModal=!0}),t.$on("IdleEnd",function(){t.showResetModal=!1}),t.$on("IdleTimeout",function(){t.startOver()}),t.start=function(){console.log("started"),d.watch(),t.started=!0,t.showResetModal=!1},t.stop=function(){d.unwatch(),t.started=!1,t.showResetModal=!1},t.closeResetModal=function(){t.showResetModal=!1},t.startOver=function(){t.stop(),r.go("landing",{},{reload:!0}),d.watch(),t.counter=60,t.stopTimer(),t.onTimeout()},document.onmousemove=t.start(),document.onclick=t.start(),document.ontouchstart=t.start(),$("body").on("click touchstart input",function(){t.counter=60,t.stopTimer(),t.onTimeout()})}]),angular.module("dashboard").filter("secondsToDateTime",[function(){return function(e){return new Date(1970,0,1).setSeconds(e)}}]),angular.module("dashboard").controller("LanguageCtrl",["$scope","localStorageService","$state","$translate",function(e,t,a,n){e.selectLang=function(e){t.set("language",e),n.use(e),a.go("scan-ramq",{},{reload:!0})},e.hideClose=!0}]),angular.module("dashboard").controller("LandingCtrl",["$log","$scope","$state","$timeout","$rootScope","localStorageService","CoreFactory",function(e,t,a,n,o,r,i){localStorage.clear(),t.turnOnScanner=function(){window.kp_padlockScan_getHardwareClass(),window.kp_padlockScan_start()},t.fakeScan=function(){t.scanValue="SRDI86541817",t.submitRAMQ()},window.kp_padlockScan_scanningDidFinish=function(e,a){t.scanValue=a,t.submitRAMQ()},t.submitRAMQ=function(){t.showLoader=!0,i.getUserByRAMQ(t.scanValue).then(function(e){r.set("user",e),t.showLoader=!1,a.go("form",{},{reload:!0})}).catch(function(){t.forgot=!0,t.wrongAppt=!0,t.showLoader=!1})},t.showForgot=function(){t.forgotShow=!0,t.forgot=!0},t.scanValue=null}]),angular.module("dashboard").controller("HomeCtrl",["$log","$scope","menu","version",function(e,t,a,n){e.log("Home Controller"),t.current_year=moment().format(),t.menu=a,t.version=n}]),angular.module("dashboard").controller("FormCtrl",["$scope","localStorageService","$state","MyProfileLocationsService","CoreFactory","$rootScope",function(e,t,a,n,o,r){e.userForm=t.get("user"),e.checkin=!0,e.showAdditionalButton=!1,e.addAddress=function(){e.showAddressFields=!0},n.getCountries().then(function(t){e.countries=t.data}).then(function(){e.getLocation()}).catch(function(e){console.log("err",e)}),e.changeCountry=function(t){e.provinces=t.provinces,e.addressObject.province=t.provinces[0]},e.formChange=!1,e.gPlace,e.showCheckinButton=!1,e.getLocation=function(){e.showLoader=!0,n.list(e.userForm.id).then(function(t){e.showLoader=!1,t.length?(e.address=t[0],e.action="update",e.provinces=e.countries.find(function(e){return e.id===t[0].country.id}).provinces,e.addressObject={name:e.address.location_name,id:e.address.id,country:e.address.country,city:e.address.city,province:e.address.province,address:e.address.address_line_1,postal_code:e.address.postal_code}):(e.action="create",e.provinces=e.countries[0].provinces,e.addressObject={name:"Home",id:null,country:e.counties?e.countries[0]:"",city:"Montreal",province:e.counties?e.countries[0].provinces[0]:"",address:"",postal_code:""}),e.showCheckinButton=!0,e.userForm.RAMQ_expiry_date&&(e.expMonth=e.userForm.RAMQ_expiry_date.split("-")[1],e.expYear=e.userForm.RAMQ_expiry_date.split("-")[0],e.expiry=new Date(e.userForm.RAMQ_expiry_date),e.expiry=new Date(+e.expiry+6e4*e.expiry.getTimezoneOffset())),e.formData=e.userForm,e.formData.mobile_phone&&(e.formData.mobile_phone=e.userForm.mobile_phone.replace("+1","")),e.$watch("addressObject",function(){e.showCheckinButton=e.addressObject.address&&e.addressObject.province&&e.addressObject.postal_code&&e.addressObject.country?!0:!1,e.showClear=e.addressObject.address.length>3?!0:!1,e.addressChange=!0},!0),e.$watch("formData",function(){console.log("form data changed"),e.formChange=!0},!0)})},e.blurredField=function(){e.showAdditionalButton=!1},e.focusedField=function(){e.showAdditionalButton=!0},e.appliedClass=function(){return e.showAdditionalButton?"showing":"hiding"},e.scroll=function(){$("html, body").animate({scrollTop:$(document).height()},200)},e.checkin=function(){console.log("press chekcin",t.get("selectedApptId")),0==t.get("selectedApptId")?o.checkInAll(e.userForm.id).then(function(){a.go("confirm")}).catch(function(){}):o.checkIn(t.get("selectedApptId"),e.userForm.id).then(function(e){t.set("waitRoom",e.data.data.waiting_room),a.go("confirm")}).catch(function(){})},e.addressChange=!1,e.addressHandle=function(){if(e.showLoader=!0,e.showAddressFields=!1,Object.keys(e.addressObject).forEach(function(t){e.addressObject[t]||(e.showAddressFields=!0)}),e.addressChange){var t="create"===e.action?n.create:n.update;t({id:e.addressObject.id,location_name:e.addressObject.name,address_line_1:e.addressObject.address,country_id:e.addressObject.country.id,province_id:e.addressObject.province.id,city:e.addressObject.city,postal_code:e.addressObject.postal_code}).then(function(){e.getLocation(),e.update()}).catch(function(t){errorAlert("",t.toString()),e.showLoader=!1,e.showAddressFields=!0})}else e.update()},r.changePlace=function(t){for(var a=0;a<t.address_components.length;a++)for(var n=0;n<t.address_components[a].types.length;n++)"postal_code"==t.address_components[a].types[n]&&(e.addressObject.postal_code=t.address_components[a].long_name);e.addressObject.postal_code&&(e.scroll(),e.showCheckinButton=!0)},e.update=function(){if(e.formChange){var t=e.formData;e.expiry.setHours(e.expiry.getHours()+12),t.RAMQ_expiry_date=[e.expiry.getFullYear(),("0"+(e.expiry.getMonth()+1)).slice(-2),"01"].join("-"),t.mobile_phone=t.mobile_phone?"+1"+e.formData.mobile_phone:"",t.email||(t.email=null),o.updateProfile(t).then(function(){e.checkin()}).catch(function(e){errorAlert("",e.toString())})}else e.checkin()}}]),angular.module("dashboard").factory("MyProfileLocationsService",["$log","$http","$q","AuthService","apiUrl","localStorageService",function(e,t,a,n,o,r){function i(e){v.locations.push(e)}function s(e){return v.locations.find(function(t){return t.id==e})}function l(){v.locations=[]}function c(r){e.info("MyProfileLocationsService::list");var i={"Content-Type":"application/json",Authorization:"Bearer "+n.getToken()};return n.getCurrentUser()?t({method:"GET",url:o+"/addresses?account_id="+r,headers:i}).then(function(e){return v.locations=e.data.data,v.locations}).catch(function(e){h(e)}):(e.info("MyProfileLocationsService::list","User is not logged in !?"),a.resolve([]))}function d(r){e.info("MyProfileLocationsService::show",r);var i={"Content-Type":"application/json",Authorization:"bearer "+n.getToken()};return alert(JSON.stringify(i)),n.getCurrentUser()?t({method:"GET",url:[o,"addresses",r].join("/"),headers:i}).then(function(e){return console.log(e),e}).catch(function(e){h(e)}):(e.info("MyProfileLocationsService::update","User is not logged in !?"),a.resolve(null))}function u(i){return e.info("MyProfileLocationsService::update",i),n.getCurrentUser()?t({method:"PATCH",url:o+"/addresses/"+i.id+"?account_id="+r.get("user").id,headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.getToken()},data:i}).then(function(e){return console.log(e),e}).catch(function(e){var t=e.data.errors,n="";return angular.forEach(t,function(e){n+=e+" "}),a.reject(n)}):(e.info("MyProfileLocationsService::update","User is not logged in !?"),a.resolve([]))}function p(i){return e.info("MyProfileLocationsService::create",i),t({method:"POST",url:o+"/addresses?account_id="+r.get("user").id,headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.getToken()},data:i}).then(function(e){return e}).catch(function(e){var t=e.data.errors,n="";return angular.forEach(t,function(e){n+=e+" "}),a.reject(n)})}function m(i){return e.info("MyProfileLocationsService::destroy",i),n.getCurrentUser()?t({method:"DELETE",url:o+"/addresses/35872?account_id="+r.get("user").id,headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.getToken()},data:i}).then(function(e){return e},h):(e.info("MyProfileLocationsService::destroy","User is not logged in !?"),a.resolve([]))}function g(){return e.info("CountriesService::list"),t({method:"GET",url:o+"/countries?include=provinces&account_id="+r.get("user").id,headers:{"Content-Type":"application/json",Authorization:"Bearer "+n.getToken()}}).then(function(e){return e.data}).catch(function(e){return a.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")})}function h(e){return a.reject(angular.isObject(e.data)&&e.data.message?e.data.message:"An unknown error occurred.")}var f={list:c,show:d,create:p,update:u,destroy:m,push:i,pop:s,clear:l,getCountries:g},v=this;return v.locations=[],f}]),angular.module("dashboard").factory("CoreFactory",["$log","$http","$q","apiUrl","AuthService","localStorageService",function(e,t,a,n,o,r){function i(){var e=o.getCurrentUser();return e?t({method:"GET",url:[n,"profile"].join("/"),headers:{Authorization:"Bearer "+e.token}}).then(function(e){return e.data&&(AccountInfo=e.data.data),a.resolve(AccountInfo)},function(){a.reject("Argument is missing")}):void a.reject("User is not logged")}function s(){return e.info("MyProfileService:: get clinic name from subdomain"),t({method:"GET",url:n,headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()}}).then(function(e){return e.data.data}).catch(function(){window.location="https://www.tapmedical.ca"})}function l(e){return t({method:"GET",url:n+"/appointments/kiosk/upcoming?account_id="+e+"&selectedLanguage="+r.get("language"),headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()}}).then(function(e){return e.data.data}).catch(function(e){return a.reject(e)})}function c(r){return e.info("MyProfileService:: get clinic name from subdomain"),t({method:"POST",url:n+"/accounts/findByRamq",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()},data:{RAMQ:r}}).then(function(e){return e.data.data}).catch(function(e){return a.reject(e)})}function d(r,i){return e.info("AppointmentsFactory::checkIN",r),t({method:"POST",url:n+"/appointments/"+r+"/check-in",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()},data:{account_id:i}}).then(function(e){return e}).catch(function(e){return a.reject(e.data.message)})}function u(r){return e.info("AppointmentsFactory::checkInAll"),t({method:"POST",url:n+"/appointments/kiosk/check-in-all",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()},data:{account_id:r}}).then(function(e){return e}).catch(function(e){return a.reject(e.data.message)})}function p(e){return e.skip_ramq_validation=!0,t({method:"PATCH",url:n+"/profile?account_id="+r.get("user").id+"&selectedLanguage="+e.preferred_language,headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.getToken()},data:e}).then(function(e){return e.data}).catch(function(e){var t=e.data.errors,n="";return angular.forEach(t,function(e){n+=e+"\n"}),a.reject(n)})}var m={show:i,getClinicName:s,getUserByRAMQ:c,checkIn:d,getUpcoming:l,updateProfile:p,checkInAll:u};return m}]),angular.module("dashboard").factory("AuthService",["$q","localStorageService",function(e,t){function a(e){console.log("AuthService.login",e),d=e,t.set(c,e)}function n(){d=null,t.set(c,null)}function o(e){return angular.isArray(e)||(e=[e]),r()&&-1!==e.indexOf(d.role)}function r(){return!!d}function i(){return d}function s(){if(d&&d.token)return d.token;var e=new Date,t=e.getMonth()+1,a=e.getDate();10>t&&(t="0"+t),10>a&&(a="0"+a);var n=sjcl.hash.sha256.hash("tapmedical"+e.getFullYear()+"-"+t+"-"+a),o=sjcl.codec.hex.fromBits(n);return o}var l={login:a,logout:n,isAuthorized:o,isAuthenticated:r,getCurrentUser:i,getToken:s},c="currentUser",d=t;return t.get(c),l}]),angular.module("dashboard").controller("ConfirmCtrl",["$scope","localStorageService","$state","$timeout",function(e,t){e.hideBack=!0,e.hideClose=!0,e.confimationClose=!0,e.showLoader=!1,e.room=t.get("waitRoom")}]),angular.module("dashboard").controller("DashboardCtrl",["$log",function(e){e.log("Dashboard Controller")}]),angular.module("dashboard").directive("scroll",function(){return{restrict:"A",link:function(e,t){t.bind("focus",function(){var e=(window.innerHeight,t.offset().top-100);$("html, body").animate({scrollTop:e})}),t.bind("blur",function(){})}}}),angular.module("dashboard").directive("googleplace",["$rootScope","localStorageService",function(e){return{require:"ngModel",link:function(t,a,n,o){var r={types:["address"],componentRestrictions:{country:"ca"}};t.gPlace=new google.maps.places.Autocomplete(a[0],r),google.maps.event.addListener(t.gPlace,"place_changed",function(){var n=t.gPlace.getPlace();t.$apply(function(){o.$setViewValue(a.val()),e.changePlace(n)})})}}}]),angular.module("dashboard").controller("AppointmentsCtrl",["$scope","localStorageService","$state","CoreFactory",function(e,t,a,n){e.showContent=!1,e.apptObject=[],e.multiple=!0,e.notMyAppt=function(){e.forgot=!0,e.wrongAppt=!0},e.time=(new Date).getTime(),n.getUpcoming(t.get("user").id).then(function(t){e.appts=t,e.multiple=!1;var a=e.appts.length;if(a){e.multiple=1==a?!1:!0;var n=new Date(e.userProfile.RAMQ_expiry_date);n.setMonth(n.getMonth()+1),n<new Date&&null!==e.userProfile.RAMQ_expiry_date&&(e.forgot=!0,e.expiredShow=!0),angular.forEach(e.appts,function(t){var a=(new Date).setHours(t.start_time.split(":")[0],parseInt(t.start_time.split(":")[1])+15);new Date>a?(t.late=!0,e.late=!0):t.late=!1,this.push(t)},e.apptObject)}else e.forgot=!0,e.noAppts=!0;e.showContent=!0,e.showLoader=!1}).catch(function(){e.forgot=!0,e.wrongAppt=!0}),e.selectAppt=function(e){t.set("selectedApptId",e),a.go("form")},e.apptsOffset=0,e.moveAppt=function(t){e.apptsOffset=e.apptsOffset+1*t}}]),$(document).ready(function(){function e(){var e=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",e+"px");var t=$("nav.navbar-default").height(),a=$("#page-wrapper").height();t>a&&$("#page-wrapper").css("min-height",t+"px"),a>t&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(t>a?$("#page-wrapper").css("min-height",t-60+"px"):$("#page-wrapper").css("min-height",$(window).height()-60+"px"))}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||e()}),setTimeout(function(){e()},500)}),$(function(){$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})}),function(){"use strict";function e(e,t,a,n,o){e.debug("runBlock end"),_.isNull(o.get("language"))&&o.set("language","EN"),t.use(o.get("language"))}e.$inject=["$log","$translate","$rootScope","$state","localStorageService"],angular.module("dashboard").run(e)}(),function(){"use strict";function e(e,t){e.state("landing",{url:"/landing",templateUrl:"app/landing/landing.html",controller:"LandingCtrl"}).state("home",{url:"/",templateUrl:"app/common/content.html"}).state("home.dashboard",{url:"/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("appointments",{url:"/appointments",templateUrl:"app/appointments/appointments.html",controller:"AppointmentsCtrl"}).state("scan-ramq",{url:"/scan-ramq",templateUrl:"app/scan-ramq/scan-ramq.html",controller:"ScanRamqCtrl"}).state("form",{url:"/form",templateUrl:"app/form/form.html",controller:"FormCtrl"}).state("confirm",{url:"/confirm",templateUrl:"app/confirm-screen/confirm.html",controller:"ConfirmCtrl"}).state("language",{url:"/language",templateUrl:"app/language/language.html",controller:"LanguageCtrl"}),t.otherwise("/landing")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("dashboard").config(e)}(),function(){"use strict";angular.module("dashboard").constant("version","1.0.0")}(),function(){"use strict";angular.module("dashboard").constant("apiUrl","https://demo.stage.tapmedical.ca/api").constant("version","1.0.0")}(),function(){"use strict";function e(e,t,a,n,o){e.debugEnabled(!0),t.translations("EN",EN),t.translations("FR",FR),t.preferredLanguage("EN"),t.useSanitizeValueStrategy(null),a.setDefaultDelay(2500),a.useIconOnNotification(!0),n.idle(545),n.timeout(15),o.interval(10)}e.$inject=["$logProvider","$translateProvider","atomicNotifyProvider","IdleProvider","KeepaliveProvider"],angular.module("dashboard").config(e)}(),angular.module("dashboard").run(["$templateCache",function(e){e.put("app/appointments/appointments.html",'<div class="text-center page-wrapper apptsScreen {{multiple == true ? \'multiple\' : \'\'}}"><div ng-include="\'app/common/small-header.html\'"></div><div class=""><div class="appts-container" ng-if="showContent"><p class="big-text faded">{{\'HI\' | translate}} {{userProfile.first_name}}!</p><h3 ng-hide="late"><span ng-if="!multiple">{{\'FOUND_APPT\' | translate}}</span> <span ng-if="multiple">{{\'FOUND_APPTS\' | translate}} {{appts.length}}</span> <span ng-if="multiple">{{\'FOUND_APPTS_END\' | translate}}</span></h3><h3 ng-show="late">{{\'RUNNING_LATE\' | translate}}</h3><div class="{{multiple == true ? \'fadeRightSmooth multiple\' : \'\'}} holder"><a href="javascript:void(0)" ng-if="multiple && apptsOffset > 0" class="moveAppts prev" ng-click="moveAppt(-1)"></a> <a href="javascript:void(0)" ng-if="multiple && apptsOffset < appts.length -2" class="moveAppts next" ng-click="moveAppt(1)"></a><div class="appointmentsBox offset-{{apptsOffset}}"><div class="single-box single-appt {{appt.late == true ? \'late\' : \'\'}} {{multiple == true ? \'\' : \'fadeRightSmooth\'}}" ng-repeat="appt in apptObject"><div class="top"><p class="time">{{appt.start_time | limitTo:5 }}</p><p class="date">{{\'TODAY\' | translate}}, {{appt.date}}</p></div><div class="doctor"><p class="doctor-name">{{appt.doctor.first_name + \' \' + appt.doctor.last_name}}</p><p class="specialty">{{appt.specialty.name}}</p></div><div class="buttonZone" ng-if="multiple && !appt.late" ng-click="selectAppt(appt.id);"><p class="purple">{{"CHECK_IN" | translate}}</p></div><p class="big-text fadeIn" ng-if="multiple && appt.late">{{\'RECEPTIONIST\' | translate}}.</p></div></div><h4 class="big-text fadeIn" ng-if="!multiple && late">{{\'RECEPTIONIST\' | translate}}.</h4></div></div><div class="right-float" ng-hide="late" ng-if="!multiple"><a class="round-button" href="javascript:void(0)" ng-click="selectAppt(appts[0].id)"></a><p class="purple">{{"CONTINUE" | translate}}</p></div></div><div class="bottom {{multiple == true ? \'left\' : \'\'}} fadeBottomSmooth"><a href="javascript:void(0)" ng-show="late" ui-sref="landing" class="button">{{\'CLOSE\' | translate}}</a> <a href="javascript:void(0)" class="button" ng-click="notMyAppt()" ng-hide="late"><span ng-if="!multiple">{{\'NOT_MINE\' | translate}}</span><span ng-if="multiple">{{\'NOT_MINE_MULTI\' | translate}}</span></a></div><div class="bottom right violet"><a href="javascript:void(0)" ng-show="multiple" ng-click="selectAppt(0)" class="button">{{\'CHECK_IN_ALL\' | translate}}</a></div></div>'),e.put("app/common/content.html",'<div id="wrapper"><div ng-include="\'app/common/navigation.html\'"></div><div id="page-wrapper" class="gray-bg {{$state.current.name}}"><div ng-include="\'app/common/topnavbar.html\'"></div><div ui-view=""></div><div ng-include="\'app/common/footer.html\'"></div></div></div>'),e.put("app/common/footer.html",'<div class="footer"><div class="pull-right">10GB of <strong>250GB</strong> Free.</div><div><strong>Copyright</strong> Example Company &copy; 2015-2016</div></div>'),e.put("app/common/ibox_tools.html",'<div class="ibox-tools" uib-dropdown=""><a ng-click="showhide()"><i class="fa fa-chevron-up"></i></a> <a uib-dropdown-toggle="" href=""><i class="fa fa-wrench"></i></a><ul uib-dropdown-menu=""><li><a href="">Config option 1</a></li><li><a href="">Config option 2</a></li></ul><a ng-click="closebox()"><i class="fa fa-times"></i></a></div>'),e.put("app/common/navigation.html",'<nav class="navbar-default navbar-static-side" role="navigation"><div class="sidebar-collapse"><ul side-navigation="" class="nav metismenu" id="side-menu"><li class="nav-header"><div class="profile-element" uib-dropdown=""><a uib-dropdown-toggle="" href=""><span class="clear"><span class="block m-t-xs"><strong class="font-bold">{{main.userName}}</strong></span> <span class="text-muted text-xs block">Example menu<b class="caret"></b></span></span></a><ul uib-dropdown-menu="" class="animated flipInX m-t-xs"><li><a href="">Logout</a></li></ul></div><div class="logo-element">IN+</div></li><li ui-sref-active="active"><a ui-sref="index.main"><i class="fa fa-laptop"></i> <span class="nav-label">Main page</span></a></li><li ui-sref-active="active"><a ui-sref="index.minor"><i class="fa fa-desktop"></i> <span class="nav-label">Minor page</span></a></li></ul></div></nav>'),e.put("app/common/small-header.html",'<div class="row small-header"><nav class="navbar navbar-static-top topbar" role="navigation"><img src="./assets/images/logo-black.png" alt="clinic logo"><a href="javascript:void(0)" class="header-close" ng-hide="hideClose" ng-click="closeModal()"></a> <a href="javascript:void(0)" class="header-close" ng-show="confimationClose" ui-sref="landing"></a> <a href="" class="button">Francais</a> <a class="countDownTimer">{{counter | secondsToDateTime | date:\'ss\'}}</a></nav></div><div class="loader padding fadeIn faster" ng-if="forgot"><img src="./assets/images/Tap_logo.svg" alt="clinic logo"><div class="medium-container"><h3 ng-if="forgotShow">{{\'FORGOT_RAMQ\' | translate}}</h3><h3 ng-if="expiredShow">{{\'EXPIRED\' | translate}}</h3><h3 ng-if="noAppts">{{\'CANT_FIND\' | translate}}</h3><h3 ng-if="wrongAppt">{{\'OOPS\' | translate}}</h3><p class="big-text">{{\'RECEPTIONIST\' | translate}}.</p><a class="button" href="javascript:void(0)" ui-sref="landing">{{\'CLOSE\' | translate}}</a></div></div><div class="closing-modal confirmed animated fadeIn faster" ng-if="closing"><a href="javascript:void(0)" class="closeModal" ng-click="closeCancel();"></a><h3>{{\'CANCEL_TEXT\' | translate}}</h3><div class="buttons"><a href="javascript:void(0);" class="white button" ng-click="closeCancel();">{{\'NO\' | translate}}, {{\'CONTINUE\' | translate}}</a> <a href="javascript:void(0);" class="white button" ng-click="closeCancel();" ui-sref="landing">{{\'YES\' | translate}}, {{\'CANCEL\' | translate}}</a></div></div><div class="loader image" ng-if="showLoader"><img src="./assets/images/Tap_logo.svg" alt="clinic logo"> <img src="./assets/images/Loading.svg" class="featured-image" alt=""><div class="medium-container"><h3 ng-hide="checkin">{{\'LOADING\' | translate}}</h3></div></div><div class="resetFlowModal" ng-if="showResetModal"><div class=""><p>{{\'IN_CUT\' | translate}} {{counter}} {{\'RESET_FLOW_MESSAGE\' | translate}}</p><a class="button dark" href="javascript:void(0)" ng-click="closeResetModal()">{{\'CONTINUE\' | translate}}</a></div></div>'),e.put("app/common/topnavbar.html",'<div class="topbar"><nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0"><img src="./assets/images/logo-white.png" alt="clinic logo"> <a href="" class="button navy">Francais</a></nav></div>'),e.put("app/confirm-screen/confirm.html",'<div class="text-center page-wrapper apptsScreen confirmed"><div ng-include="\'app/common/small-header.html\'"></div><div class="animated fadeIn"><div class="medium-container"><img src="./assets/images/Check.svg" class="check" alt=""><h3>{{\'ALL_SET\' | translate}}</h3><h3 ng-if="room">{{\'WAIT_ROOM\' | translate}} <span>{{room}}</span></h3></div></div><div class="appsection"><div class="bottom-purple"><img src="./assets/images/Iphone@4x.png" alt="phone"><div class="pull-left"><h3>{{\'UPDATES\' | translate}}</h3><p>{{\'DOWNLOAD\' | translate}}</p></div><div class="apps"><a class="app"></a> <a class="play"></a></div></div></div></div>'),e.put("app/dashboard/dashboard.html",'<div class="wrapper wrapper-content animated fadeInRight"><div class="row"><div class="col-xs-12"><div class="ibox float-e-margins"><div class="ibox-title"><h5><i class="fa fa-history"></i> Dashboard</h5></div><div class="ibox-content"></div></div></div></div></div>'),e.put("app/form/form.html",'<div class="text-center page-wrapper apptsScreen"><div ng-include="\'app/common/small-header.html\'"></div><div class="animated fadeIn"><div class="wide-container form-container"><h3>{{\'VERIFY_INFO\' | translate}}</h3><form ng-submit="addressHandle()" class="checkinForm"><div class="inputs-holder"><label for="mobile">{{\'CELL\' | translate}} ({{\'OPTIONAL\' | translate}})</label> <input type="tel" name="" id="mobile" value="" mask-clean="true" mask="(999) 999-9999" ng-model="formData.mobile_phone" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"> <label for="mobile">{{\'HOME\' | translate}} ({{\'OPTIONAL\' | translate}})</label> <input type="tel" name="" id="mobile" value="" mask-clean="true" mask="(999) 999-9999" ng-model="formData.mobile_phone" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"> <label for="email">{{\'EMAIL\' | translate}} ({{\'OPTIONAL\' | translate}})</label> <input type="email" name="" value="" id="email" ng-model="formData.email" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"></div><div class="inputs-holder"><div class="addressFields"><div class="holder"><label for="address">{{\'ADDRESS\' | translate}}</label> <input type="text" name="" id="address" value="" class="" ng-model="addressObject.address" googleplace="" placeholder="" required="" scroll="" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"> <span class="clear" ng-if="showClear" ng-click="addressObject.address = \'\'"></span></div><div class="half"><label for="city">{{\'CITY\' | translate}}</label> <input type="text" name="" id="city" value="" ng-model="addressObject.city" required="" scroll="" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"></div><div class="half"><label for="country">{{\'COUNTRY\' | translate}}</label><select class="select-box" name="country" ng-model="addressObject.country" ng-options="item.name for item in countries track by item.id" ng-change="changeCountry(addressObject.country)" ng-blur="blurredField()" ng-focus="focusedField()"></select></div><div class="half"><label for="province">{{\'PROVINCE\' | translate}}</label><select class="select-box" name="province" ng-model="addressObject.province" ng-options="item.name for item in provinces track by item.id" ng-blur="blurredField()" ng-focus="focusedField()"></select></div><div class="half"><label for="postal">{{\'POSTAL\' | translate}}</label> <input type="text" name="" id="postal" value="" ng-model="addressObject.postal_code" required="" scroll="" oninvalid="this.setCustomValidity(\' \')" oninput="this.setCustomValidity(\'\')" ng-blur="blurredField()" ng-focus="focusedField()"></div></div></div><div class="buttonHolder"><input type="submit" class="button green" value="Check In"><p>If everything looks good, press here →</p><input type="submit" class="button green extraButton fadeInBottomButton" ng-class="appliedClass()" value="Check In →"></div></form></div></div></div>'),e.put("app/language/language.html",'<div class="text-center page-wrapper apptsScreen"><div ng-include="\'app/common/small-header.html\'"></div><div class="animated"><div class="medium-container"><div class="single-box fadeRightSmooth" ng-click="selectLang(\'FR\')"><p>Bienvenue</p><h3>Continuer en français</h3><a class="round-button inline"></a></div><div class="single-box fadeRightSmooth slower" ng-click="selectLang(\'EN\')"><p>Welcome</p><h3>Continue in English</h3><a class="round-button inline"></a></div></div></div></div>'),e.put("app/landing/landing.html",'<div class="text-center page-wrapper loginscreen" ng-init="turnOnScanner()"><div ng-include="\'app/common/topnavbar.html\'"></div><div class="wrapper"><div class="text-container left"><div class=""><h1>Self check-in</h1><h2>Please scan your health card to check-in</h2><div class="links"><a href="">I forgot my health card</a> <a ui-sref="scan-ramq">Enter health card manually</a></div></div></div><div class="arrow" ng-click="fakeScan()"><p>Line up your barcode with the red dot</p></div></div></div>'),e.put("app/scan-ramq/scan-ramq.html",'<div class="text-center page-wrapper apptsScreen scan-ramq" ng-init="turnOnScanner()"><div ng-include="\'app/common/small-header.html\'"></div><div class="fadeRightSmooth"><div class="medium-container text-center"><h1 class="">{{\'SCAN_RAMQ_TITLE\' | translate}} {{\'YOUR\' | translate}} {{\'SCAN_RAMQ_END\' | translate}}</h1><form class="scanRamqForm" autocomplete="off"><input type="text" id="scanInput" name="" ng-model="scanValue" autocomplete="false" value="" class="ramq-input" required=""> <label for="">{{\'RAMQ_NUMBER\' | translate}}</label> <a href="" class="button green" ng-click="submitRAMQ()">{{\'CONTINUE\' | translate}}</a></form></div></div></div>')
}]);